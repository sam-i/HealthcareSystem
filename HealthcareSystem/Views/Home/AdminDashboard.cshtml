@model HealthcareSystem.ViewModels.AdminDashboardViewModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<h2>Admin Dashboard</h2>

<!-- Logout Button -->
<form action="@Url.Action("Logout", "Admin")" method="post" style="position: absolute; top: 10px; right: 10px;">
    <button type="submit" class="btn btn-danger">Logout</button>
</form>

<!-- Add New User Buttons -->
<div class="mb-4">
    <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addDoctorModal">
        Add Doctor
    </button>
    <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addRadiologistModal">
        Add Radiologist
    </button>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPatientModal">
        Add Patient
    </button>
</div>

<div class="dashboard-stats">
    <div class="stat-box">
        <h3>Total Patients</h3>
        <p>@Model.TotalPatients</p>
    </div>
    <div class="stat-box">
        <h3>Total Doctors</h3>
        <p>@Model.TotalDoctors</p>
    </div>
    <div class="stat-box">
        <h3>Total Radiologists</h3>
        <p>@Model.TotalRadiologists</p>
    </div>
    <div class="stat-box">
        <h3>Total System Cost</h3>
        <p>@Model.TotalSystemCost.ToString("C")</p>
    </div>
</div>

<h3>Patients</h3>
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Address</th>
            <th>Assigned Doctor</th>
            <th>Assigned Radiologist</th>
            <th>Total Cost</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>   
        @foreach(var patient in Model.Patients)        
        {           
            <tr>               
                <td>@patient.Name</td>                
                <td>@patient.Address</td>                
                <td>@patient.AssignedDoctorName</td>                
                <td>@patient.AssignedRadiologistName</td>                
                <td>@patient.TotalCost.ToString("C")</td>                
                <td>
                    <button class="btn btn-sm btn-primary" onclick="editPatient(@patient.Id)">Edit</button>                   
                    <button class="btn btn-sm btn-danger" onclick="confirmDelete('patient', @patient.Id)">Delete</button>
                </td>  
            </tr>        
        }
    </tbody>
</table>

<h3>Doctors</h3>
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Patients Count</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>  
        @foreach (var doctor in Model.Doctors)        
        {            
            <tr>               
                <td>@doctor.Name</td>               
                <td>@doctor.PatientCount</td>                
                <td>                  
                    <button class="btn btn-sm btn-primary" onclick="editDoctor(@doctor.Id)">Edit</button>                    
                    <button class="btn btn-sm btn-danger" onclick="confirmDelete('doctor', @doctor.Id)">Delete</button>               
                </td>           
            </tr>       
        }
    </tbody>
</table>

<h3>Radiologists</h3>
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Patients Count</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var radiologist in Model.Radiologists)       
        {           
            <tr>               
                <td>@radiologist.Name</td>                
                <td>@radiologist.PatientCount</td>
                <td>                    
                    <button class="btn btn-sm btn-primary" onclick="editRadiologist(@radiologist.Id)">Edit</button>                   
                    <button class="btn btn-sm btn-danger" onclick="confirmDelete('radiologist', @radiologist.Id)">Delete</button>                
                </td>           
            </tr>        
        }
    </tbody>
</table>

<!-- Add Doctor Modal -->
<div class="modal fade" id="addDoctorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Doctor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form asp-controller="Admin" asp-action="AddDoctor" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" name="Username" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" name="Name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" name="Password" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assign Patients</label>
                        <select class="form-select" name="PatientIds" multiple>
                            @foreach (var patient in Model.Patients)
                            {
                                <option value="@patient.Id">@patient.Name</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Doctor</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Radiologist Modal -->
<div class="modal fade" id="addRadiologistModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Radiologist</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form asp-controller="Admin" asp-action="AddRadiologist" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" name="Username" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" name="Name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" name="Password" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assign Patients</label>
                        <select class="form-select" name="PatientIds" multiple>
                            @foreach (var patient in Model.Patients)
                            {
                                <option value="@patient.Id">@patient.Name</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Radiologist</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Patient Modal -->
<div class="modal fade" id="addPatientModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Patient</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form asp-controller="Admin" asp-action="AddPatient" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" name="Username" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" name="Name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" name="Password" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-control" name="Address" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Current Condition</label>
                        <input type="text" class="form-control" name="CurrentCondition">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assigned Doctor</label>
                        <select class="form-select" name="AssignedDoctorId">
                            <option value="">Select Doctor</option>
                            @foreach (var doctor in Model.Doctors)
                            {
                                <option value="@doctor.Id">@doctor.Name</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assigned Radiologist</label>
                        <select class="form-select" name="AssignedRadiologistId">
                            <option value="">Select Radiologist</option>
                            @foreach (var radiologist in Model.Radiologists)
                            {
                                <option value="@radiologist.Id">@radiologist.Name</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Patient</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this record?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Initialize multiple select dropdowns with Select2
            $('select[multiple]').select2({
                width: '100%',
                placeholder: 'Select patients'
            });
        });
        function confirmDelete(type, id) {
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            const confirmBtn = document.getElementById('confirmDeleteBtn');

            confirmBtn.onclick = function () {
                // Send delete request
                fetch(`/Admin/Delete${type.charAt(0).toUpperCase() + type.slice(1)}/${id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Error deleting record');
                    }
                });
                modal.hide();
            };

            modal.show();
        }

        // Handle edit redirects
        function editPatient(id) {
            window.location.href = `/Admin/EditPatient/${id}`;
        }

        function editDoctor(id) {
            window.location.href = `/Admin/EditDoctor/${id}`;
        }

        function editRadiologist(id) {
            window.location.href = `/Admin/EditRadiologist/${id}`;
        }
    </script>
}